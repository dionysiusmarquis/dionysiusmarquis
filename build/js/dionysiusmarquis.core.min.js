/* D I O N Y S I U S  M A R Q U I S */
"undefined"==typeof dm&&(dm=new Object),dm.Event=function(a,b,c){this.target=null,this.currentTarget=null,this.type=a,this.data=b,this.bubble=c,this.isBubbling=!1,this.getType=function(){return this.type},this.getdata=function(){return this.data},this.getBubble=function(){return this.bubble}},dm.EventTarget=function(){var a=new Object,b=new Object,c=new Object;this.addEventListener=function(d,e,f,g){a[d]||(a[d]=new Array,b[d]=new Array,c[d]=new Array),(0==a.length||-1==a[d].indexOf(e))&&(a[d].push(e),b[d].push(g),c[d].push(f))},this.removeEventListener=function(c,d){if(a[c]){var e=a[c].indexOf(d);-1!=e&&(a[c].splice(e,1),b[c].splice(e,1))}},this.hasEventListener=function(b,c){return a.length>0&&a[b]&&-1!=a[b].indexOf(c)},this.dispatchEvent=function(d){if(d&&(!d||d.type&&""!=d.type)){if(d.isBubbling||(d.currentTarget=this),d.target=this,a[d.type]&&a[d.type].length>0){var e,f,g,h,i,j,k=a[d.type];for(e=0;e<k.length;e++){if(g=b[d.type][e],i=c[d.type][e],g)if(d.data)for(h=Object.keys(g),f=0;f<h.length;f++)j=h[f],d.data[j]=g[j];else d.data=g;k[e].call(i||this,d)}}d.bubble&&this.parent&&this.parent.isEventDispatcher&&(d.isBubbling=!0,this.parent.dispatchEvent(d))}},this.isEventDispatcher=!0},"undefined"==typeof dm&&(dm=new Object),dm.HTMLElement=function(a,b,c,d){function e(){"undefined"!=typeof document.body.style.transition?k.element.addEventListener("transitionend",f):"undefined"!=typeof document.body.style.WebkitTransition?k.element.addEventListener("webkitTransitionEnd",f):"undefined"!=typeof document.body.style.MozTransition?k.element.addEventListener("transitionend",transitionEndEventHandler):"undefined"!=typeof document.body.style.OTransition&&k.element.addEventListener("oTransitionEnd",f)}function f(a){if(a.target==k.element){var b=k.getTransition(a.propertyName);if(k.transitions[1]){var c=k.transitions[1][a.propertyName];c&&(delete k.transitions[1][a.propertyName],k.updateTransitionString())}b&&b[1]&&b[1].call(b[2]||k),k.dispatchEvent(new dm.Event("transitionend",a))}}function g(a){var b=document.isFullscreen||document.mozIsFillScreen||document.webkitIsFullScreen;k.isFullscreen=b,k.dispatchEvent(new dm.Event("fullscreenchange",{isFullscreen:b}))}function h(a,b){var c=k.ATTRIBUTE_REGEX;if(c.test(a)&&(a=a.replace(c,function(a,b){return b.toUpperCase()})),"undefined"!=typeof document.body.style[a]){if(!b)return a;if(-1==a.indexOf(k.VENDOR_PREFIX))return j(a);a=a.replace(k.VENDOR_PREFIX,"")}var d=k.VENDOR_PREFIX+a.charAt(0).toUpperCase()+a.slice(1);return"undefined"!=typeof document.body.style[d]?b?"-"+j(d):d:"float"==a&&"undefined"!=document.body.style.cssFloat?"cssFloat":void 0}function i(a,b){var c=new Object;for(var d in a)c[h(d,b)]=a[d];return c}function j(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})}dm.EventTarget.call(this);var k=this;this.id=b,this.className=c,this.style=d,this.parent=null,this.isSelectable=!0,this.isFullscreen=!1,this.children=new Array,this.transitions=new Object,this.addChild=function(a){return this.children.push(a),a.setParent(this),a},this.addChildAt=function(a,b){return this.addChild(a),this.setChildIndex(a,b),a},this.removeChild=function(a){return this.children.splice(this.children.indexOf(a),1),a.setParent(null),a},this.createElement=function(a){if(a){"string"==typeof a?(this.element=document.createElement("div"),this.element.innerHTML=a,this.element=this.element.firstChild):this.element=a,this.parent=this.element.parentElement,this.setId(this.id||this.element.id),this.style?this.setStyle(this.style):this.style=this.element.style;var b=this.className;this.className=this.getClassNames().join(" "),this.addClassName(b||""),e()}},this.appendToElement=function(a){a.appendChild(this.element)},this.setStyle=function(a,b){if(a){b=void 0==b?!0:b;for(var c in a){var d=b?h(c):c;d&&(this.element.style[d]=null==a[c]?"":a[c])}this.style=this.element.style}},this.setId=function(a){this.id=a&&""!=a?a:null,this.element&&(this.id?this.element.id=this.id:this.element.removeAttribute("id"))},this.setClassName=function(a){this.className=a&&""!=a?a:null,this.className?this.element.setAttribute("class",this.className):this.element.removeAttribute("class"),this.updateTransitionString()},this.addClassName=function(a){if(!(!a||""==a||this.className&&this.hasClassName(a))){var b=this.className&&""!=this.className?this.className+" ":"";this.setClassName(b+a)}},this.toggleClassName=function(a){var b=this.getClassNames(),c=b.indexOf(a);-1!=c?b.splice(c,1):b.push(a),this.setClassName(b.join(" "))},this.removeClassName=function(a){if(this.className){var b=this.getClassNames(),c=b.indexOf(a);-1!=c&&(b.splice(c,1),this.setClassName(b.join(" ")))}},this.setParent=function(a){a?a.element!=this.element.parentElement&&a.element.appendChild(this.element):this.parent&&this.parent.element.removeChild(this.element),this.parent=a},this.setIndex=function(a){if(this.parent){var b=this.parent.children;if(0>a&&(a=b.length<=-a?0:b.length+a),b.length<a&&(a=b.length-1),this.parent.isDisplayObject)this.parent.setChildIndex(this,a);else{var c=this.getIndex(),d=c>a?this.parent.children[a]:this.parent.children[a+1];this.parent.insertBefore(d)}}},this.setChildIndex=function(a,b){var c=this.getChildIndex(a);if(c!=b&&a.isDisplayObject){var d=c>b?this.children[b]:this.children[b+1];this.children.splice(c,1),this.children.splice(b,0,a),d?this.element.insertBefore(a.element,d.element):this.element.appendChild(a.element)}},this.setPointer=function(a){this.setStyle(a?{cursor:"pointer"}:{cursor:null})},this.setPointerEvents=function(a,b){this.setStyle(a?b?{pointerEvents:"all"}:{pointerEvents:null}:{pointerEvents:"none"})},this.setSelectable=function(a){this.isSelectable=a,this.setStyle(a?{userSelect:null}:{userSelect:"none"})},this.setVisible=function(a){this.setStyle(a?{display:null}:{display:"none"})},this.toggleFullscreen=function(){this.isFullscreen?this.cancelFullscreen():this.requestFullscreen()},this.requestFullscreen=function(){this.isFullscreen=!0,this.element.requestFullscreen?this.element.requestFullscreen():this.element.mozRequestFullScreen?this.element.mozRequestFullScreen():this.element.webkitRequestFullscreen&&this.element.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",g),document.addEventListener("webkitfullscreenchange",g),document.addEventListener("mozfullscreenchange",g)},this.cancelFullscreen=function(){this.isFullscreen=!1,this.element.cancelFullscreen?this.element.cancelFullscreen():this.element.mozCancelFullScreen?this.element.mozCancelFullScreen():this.element.webkitCancelFullScreen&&this.element.webkitCancelFullScreen()},this.transitionFrom=function(a,b,c,d,e,f){this.setStyle(a),window.setTimeout(function(){k.transition(b,c,d,e,f)},50)},this.transition=function(a,b,c,d,e,f){if(0!=b){a=i(a);var g,j,l=new Array,m=!1,n=h("transition");for(j in a)g=String(a[j]),this.style[j]==g||this.getComputetStyleProperty(j)==g?delete a[j]:(m=!0,l.push(j));return!m&&e?void e.call(f||this):void(l.length&&(n&&this.addTransitions(1,l,b,c,d,e,f,!0),window.setTimeout(function(){k.setStyle(a,!1),!n&&e&&e.call(f||this)},Number.MIN_VALUE)))}},this.addTransition=function(a,b,c,d,e,f,g,i,j){if(a=a||0,this.transitions[a]||(this.transitions[a]=new Object),i||!this.transitions[a][b]){j=0==j?!1:!0,d=d||"ease",b=h(b,!0);var k=b+" "+(c||0)+"s"+(e||"ease"!=d?" "+d:"")+(e?" "+e+"s":"");return this.transitions[a][b]=new Object,this.transitions[a][b][0]=k,this.transitions[a][b][1]=f,this.transitions[a][b][2]=g,j&&this.updateTransitionString(),k}},this.addTransitions=function(a,b,c,d,e,f,g,i,j){j=0==j?!1:!0;for(var k,l,m,n=!(!c||"number"==typeof c),o=!(!d||"string"==typeof d),p=!(!e||"number"==typeof e),q=new Array,r=0;r<b.length;r++)l=this.transitions[a||0],m=h(b[r],!0),!i&&l&&l[m]||(k=this.addTransition(a,m,n?c[r]:c,o?d[r]:d,p?e[r]:e,0===r?f:null,0===r?g:null,i,!1),q.push(k));return j&&this.updateTransitionString(),q},this.updateTransition=function(a,b,c,d,e){a=a||0;var f=this.transitions[a];if(f){b=h(b,!0);var g=f[b][0];if(g){g=g.split(" ");for(var i=1;4>i;i++)1==i&&void 0!==c&&(g[1]=c+"s"),2==i&&d&&(g[2]=d),3==i&&void 0!==e&&(g[3]=e+"s");f[b][0]=g.join(" "),this.updateTransitionString()}}},this.updateTransitionString=function(){var a,b,c,d,e="",g=h("transition");for(c in this.transitions[1]){d=!0;break}if(a=dm.Utils.Object.clone(d?this.transitions[1]:this.transitions[0]),this.className){var i,j;if(b=0,a||(a=new Object),this.transitions[0]&&d)for(c in this.transitions[0])a[c]=this.transitions[0][c];var k=this.getClassNames();for(b=0;b<k.length;b++)if(i=k[b],j=this.transitions[i])for(c in j)a[c]=j[c]}b=0;for(c in a)g?(0!=b&&(e+=", "),e+=a[c][0],b++):f({target:this.element,propertyName:c});g&&this.setStyle({transition:""==e?null:e})},this.getTransition=function(a,b){if(b)return this.transitions[b||0][a];var c=this.getClassNames();c.unshift(0),c.push(1);for(var d,e,f=0;f<c.length;f++)d=k.transitions[c[f]],d&&d[a]&&(e=d[a]);return e},this.getComputetStyleProperty=function(a,b){var c=window.getComputedStyle(this.element,null).getPropertyValue(a);return b?Number(c.replace("px","")):c},this.getClassNames=function(){if(!this.element.className)return new Array;if(this.element.className.split)return this.element.className.split(" ");if(this.element.className.baseVal)return this.element.className.baseVal.split(" ");var a=this.element.classList;if(a){for(var b=new Array,c=0;c<a.length;c++)b.push(a[c]);return b}return new Array},this.getIndex=function(){var a;if(this.parent.isDisplayObject)a=this.parent.getChildIndex(this);else{a=0;for(var b=this.element;null!=(b=b.previousSibling);)a++}return a},this.isVisible=function(){return!("none"===this.getComputetStyleProperty("display"))},this.hasClassName=function(a){return-1!=this.getClassNames().indexOf(a)},this.getChildIndex=function(a){return this.children.indexOf(a)},this.getStyleProperty=function(a){return this.style[a]},this.getChildren=function(){return this.children},this.getId=function(){return this.element.id},this.getStyle=function(){return this.style},this.getClassName=function(){return this.className},this.getElement=function(){return this.element},this.getParent=function(){return this.parent},this.getWidth=function(){return this.element.offsetWidth},this.getHeight=function(){return this.element.offsetHeight},this.getIsSelectable=function(){return this.isSelectable},this.getIsFullscreen=function(){return this.isFullscreen},this.createElement(a),this.isDisplayObject=!0},dm.HTMLElement.prototype=Object.create(dm.EventTarget.prototype),dm.HTMLElement.prototype.ATTRIBUTE_REGEX=/\-([a-z])/gi,document.addEventListener("DOMContentLoaded",function(){dm.HTMLElement.prototype.VENDOR_PREFIX=function(){var a=/^(Moz|Webkit|webkit|Khtml|O|ms|Icab)(?=[A-Z])/,b="";for(var c in document.body.style)if(a.test(c))return b=c.match(a)[0];a=/(moz|webkit|ms)/;var d,e,f=window.getComputedStyle(document.documentElement,"");for(d=0;d<f.length;d++)if(e=f[d],a.test(e))return e.match(a)[0]}()}),"undefined"==typeof dm&&(dm=new Object),dm.Utils=new Object,dm.Utils.Math={random:function(a,b,c){return c=c||0,Number((Math.random()*(b-a)).toFixed(c))+a},percentage:function(a,b){return b/(a/100)},interpolate:function(a,b,c){return a+(b-a)*c},interpolate2:function(a,b,c){return(1-c)*a+c*b},distance:function(a,b,c,d){var e=0,f=0;return e=c-a,e*=e,f=d-b,f*=f,Math.sqrt(e+f)},angle:function(a,b,c,d){var e=180*Math.atan2(d-b,c-a)/Math.PI;return 0>e?e+360:e},percSin:function(a,b,c,d){return b=1/b||1,c=c||0,d=10*d||100,Math.round(Math.sin((c+a)*(Math.PI/2)*b)*d)/d}},dm.Utils.Color={hsv2rgb:function(a,b,c){var d,e,f=[];if(0===b)d=[c,c,c];else switch(a/=60,e=Math.floor(a),f=[c*(1-b),c*(1-b*(a-e)),c*(1-b*(1-(a-e)))],e){case 0:d=[c,f[2],f[0]];break;case 1:d=[f[1],c,f[0]];break;case 2:d=[f[0],c,f[2]];break;case 3:d=[f[0],f[1],c];break;case 4:d=[f[2],f[0],c];break;default:d=[c,f[0],f[1]]}for(e=0;e<d.length;e++)d[e]=Math.round(255*d[e]);return d},hsv2hex:function(a,b,c){var d=hsv2rgb(a,b,c);return"#"+d.map(function(a){return("0"+a.toString(16)).slice(-2)}).join("")},rgbToHex:function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1,7)},hexToRgb:function(a){var b=parseInt(a,16),c=b>>16&255,d=b>>8&255,e=255&b;return[c,d,e]}},dm.Utils.Date={convert:function(a,b){var c=new Date(a.replace(/-/g,"/")),d=c.getDate();10>d&&(d="0"+d);var e=c.getMonth()+1;10>e&&(e="0"+e);var f=c.getHours();10>f&&(f="0"+f);var g=c.getMinutes();return 10>g&&(g="0"+g),b?(b=b.replace("d",d),b=b.replace("m",e),b=b.replace("Y",c.getFullYear()),b=b.replace("H",f),b.replace("i",g)):d+"."+e+"."+c.getFullYear()+"; "+f+":"+g}},dm.Utils.Draw={getGap:function(a,b,c,d,e,f){e=e||3,f=f||250;var g=new Array;g.push({x:a,y:b});var h=c-a,i=d-b,j=Math.sqrt(Math.pow(h,2)+Math.pow(i,2));if(j>e&&f>j){var k;for(k=1;j/e+1>k;k++)g.push({x:a+h/(j/e)*k,y:b+i/(j/e)*k})}return g}},dm.Utils.Object={clone:function(a){if(null===a||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},merge:function(a,b,c){c&&(a=dm.Utils.Object.clone(a));for(var d in b)a[d]=b[d];return a},toQueryString:function(a){for(var b=Object.keys(a),c="",d=0;d<b.length;d++)c+=b[d]+"="+encodeURIComponent(a[b[d]]),d!=b.length-1&&(c+="&");return c}},dm.Utils.Image={getSrcset:function(a){var b=a.src;if(a.srcset){var c,d,e,f,g,h,i=window.innerWidth||document.documentElement.clientWidth,j=window.innerHeight||document.documentElement.clientHeight,k=window.devicePixelRatio||1,l=a.srcset.split(","),m=i/k,n=j/k;for(c=0;c<l.length;c++)d=l[c].split(" "),2==d.length&&(f=k,g=0,h=0,e=d[1],"x"==e.slice(-1)&&(f=Number(e.slice(0,-1)),f==k&&(b=d[0])),"w"==e.slice(-1)&&(g=Number(e.slice(0,-1)),g/=k,m>=g&&(b=d[0])),"h"==e.slice(-1)&&(h=Number(e.slice(0,-1)),h/=k,n>=f&&(b=d[0])))}return b}},dm.Utils.Form={setFormDisabled:function(a,b){var c,d=a.querySelectorAll("input, textarea, select, option, button");for(c=0;c<d.length;c++)d[c].disabled=b},resetForm:function(a){var b,c,d=a.querySelectorAll('input:not([type="submit"]), textarea, select, option');for(b=0;b<d.length;b++)switch(c=d[b],c.type){case"checkbox":c.checked=!1;break;default:c.value=""}},getFormValue:function(a){switch(a.type){case"checkbox":return a.name.indexOf(!0)?a.checked?a.value:!1:a.checked?1:0;default:return a.value}},getFormDataQuery:function(a){var b,c,d,e=new Array,f=a.querySelectorAll('input:not([type="submit"]), textarea, select, option');for(b=0;b<f.length;b++)c=f[b],d=dm.Utils.Form.getFormValue(c),d!==!1&&e.push(c.name+"="+encodeURIComponent(d));return e.join("&")},toQueryString:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},getMultiPartFormData:function(a,b,c){var d,e,f="",g=a.querySelectorAll('input:not([type="submit"]), textarea, select, option');for(d=0;d<g.length;d++)e=g[d],""===e.value;return f+="--"+b+"--"},getFormData:function(a){var b,c,d=new Object,e=a.querySelectorAll('input:not([type="submit"]), textarea, select, option');for(b=0;b<e.length;b++)c=e[b],d[c.name]=dm.Utils.Form.getFormValue(c);return d},validateEmail:function(a){var b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)}},dm.Utils.CSS={getFontFaces:function(){var a,b,c,d=document.styleSheets,e=new Array;for(a=0;a<d.length;a+=1){var f=d[a].cssRules;for(b=0;b<f.length;b+=1)f[b].constructor===CSSFontFaceRule&&(c=f[b].style.getPropertyValue("font-family").replace(/'|"/g,""),-1==e.indexOf(c)&&e.push(c))}return e}},"undefined"==typeof dm&&(dm=new Object),dm.HTMLCanvasElement=function(a,b,c){function d(a){var b=a.indexOf("<svg"),c=a.lastIndexOf("/svg>");return a=a.substring(b,c+5),a=a.replace(/NS[0-9]+:ns[0-9]+:xmlns:ns[0-9]+=\"\"/g,""),a=a.replace(/NS[0-9]+:xmlns:ns[0-9]+=\"\"/g,""),a=a.replace(/xmlns:NS[0-9]+=\"\"/g,""),a=a.replace(/NS[0-9]+:xmlns:xml=\"http:\/\/www.w3.org\/XML\/[0-9]+\/namespace\"/g,""),a=a.replace(/xmlns:xml=\"http:\/\/www.w3.org\/XML\/[0-9]+\/namespace\"/g,""),a=a.replace(/NS[0-9]+(:ns[0-9]+)+:/g,""),a=a.replace(/NS1:xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\"/,'xmlns:xlink="http://www.w3.org/1999/xlink"'),a=a.replace(/xmlns:xlink=\"http:\/\/www.w3.org\/1999\/xlink\" xlink:href/g,"xlink:href")}function e(a){var b=a.cloneNode();b.style.display="block",b.style.height="auto",b.textContent="",a.parentElement.appendChild(b);var c=b.offsetHeight;b.textContent="M\ng";var d=b.offsetHeight-c;return a.parentElement.removeChild(b),d}function f(a,b,c){var d=a.offsetWidth;return n.useDevicePixelRatio&&window.devicePixelRatio&&(d*=window.devicePixelRatio),Math.floor(d)}function g(a,b,c){var d=a.offsetHeight;return n.useDevicePixelRatio&&window.devicePixelRatio&&(d*=window.devicePixelRatio),Math.floor(d)}function h(a,b,c,d,e){{var f=a.getPropertyValue("border-top-width"),g=a.getPropertyValue("border-bottom-width"),h=a.getPropertyValue("border-left-width"),i=a.getPropertyValue("border-right-width");d||a.getPropertyValue("border-top-color"),d||a.getPropertyValue("border-bottom-color"),d||a.getPropertyValue("border-left-color"),d||a.getPropertyValue("border-right-color")}f=Number(f.replace("px","")),g=Number(g.replace("px","")),h=Number(h.replace("px","")),i=Number(i.replace("px","")),(0!==f||0!==g||0!==h||0!==i)&&(n.context.save(),n.context.globalAlpha=e,n.context.beginPath(),0!==f&&(n.context.lineWidth=2*f,n.context.moveTo(0,0),n.context.lineTo(b,0)),0!==g&&(n.context.lineWidth=2*g,n.context.moveTo(0,c),n.context.lineTo(b,c)),0!==h&&(n.context.lineWidth=2*h,n.context.moveTo(0,0),n.context.lineTo(0,c)),0!==i&&(n.context.lineWidth=2*i,n.context.moveTo(b,0),n.context.lineTo(b,c)),n.context.stroke(),n.context.restore())}function i(a,b,c,d){var e=a.getPropertyValue("background-color");-1==e.indexOf("0)")&&(n.context.save(),n.context.globalAlpha=d,n.context.setTransform(1,0,0,1,0,0),n.context.fillStyle=e,n.context.fillRect(0,0,b,c),n.context.restore())}function j(a,b,c,d,e){var f=b.getPropertyValue("background-repeat"),g=b.getPropertyValue("background-position-x"),h=b.getPropertyValue("background-position-y");g=Number(g.replace("px","")),h=Number(h.replace("px","")),n.context.save();var i=n.context.createPattern(a,f);n.context.globalAlpha=e,n.context.setTransform(1,0,0,1,0,0),n.context.translate(g,h),n.context.fillStyle=i,n.context.fillRect(-g,-h,c+g,d+h),n.context.restore()}function k(a,b,c,d,e,j,k){var l=c.getPropertyValue("border-top-width"),m=c.getPropertyValue("border-bottom-width"),o=c.getPropertyValue("border-left-width"),p=c.getPropertyValue("border-right-width"),q=c.getPropertyValue("padding-top"),r=c.getPropertyValue("padding-bottom"),s=c.getPropertyValue("padding-left"),t=c.getPropertyValue("padding-right"),u=f(b,c,!0),v=g(b,c,!0);q=Number(q.replace("px","")),r=Number(r.replace("px","")),s=Number(s.replace("px","")),t=Number(t.replace("px","")),l=Number(l.replace("px","")),m=Number(m.replace("px","")),o=Number(o.replace("px","")),p=Number(p.replace("px","")),k&&n.setSize(u,v),i(c,u,v,j),h(c,u,v,null,j),u-=s+t+o+p,v-=s+t+l+m,d+=s+o,e+=q+l,n.context.save(),n.context.globalAlpha=j,n.context.setTransform(1,0,0,1,0,0),n.context.drawImage(a,d,e,u,v),n.context.restore()}function l(a){var b=window.getComputedStyle(a,null),c="IMG"==a.nodeName;n.setSize(f(a,b,c),g(a,b,c))}function m(a,b){var c,d,e=b||new Array,f=e.length,g=a.children;for(c=0;c<g.length;c++)d=g[c],d.childElementCount?(m(d,e),e.length==f&&e.push(d)):"BR"!=d.nodeName&&e.push(d);return e}dm.HTMLElement.call(this,a),this.canvas=b||document.createElement("canvas"),this.context=this.canvas.getContext("2d");var n=this,o=navigator.userAgent,p=!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(o)&&/Chrome/i.test(o);p=!1,this.autoSize=c!==!1,this.useDevicePixelRatio=!1,this.addDOMElement=function(a,b,c,d,e,f){if(void 0!==a.childElementCount){f=void 0===f?this.autoSize:f,b=b||0,c=c||0,f&&l(a);var g;if(a.childElementCount){g=m(a);var h,i,j,k;for(h=0;h<g.length;h++)i=g[h],j=a.getBoundingClientRect(),k=i.getBoundingClientRect(),this.addDOMElement(i,k.left-j.left+b,k.top-j.top+c,d,e,!1)}else g={length:0};if(!g.length)switch(a.nodeName){case"SVG":this.addSvgElement(a,b,c,d,e,f);break;case"IMG":this.addImage(a,b,c,e,f);break;default:this.addElement(a,b,c,d,e,f)}}},this.addImage=function(a,b,c,d,e){b=b||0,c=c||0,d=void 0===d?1:d,e=void 0===e?this.autoSize:e;var f=window.getComputedStyle(a,null),g=new Image;g.onload=function(){k(g,a,f,b,c,d,e),n.dispatchEvent(new dm.Event("load")),n.dispatchEvent(new dm.Event("update"))},g.src=dm.Utils.Image.getSrcset(a)},this.addSvgElement=function(a,b,c,e){e=void 0===e?this.autoSize:e,e&&l(a),canvg(this.canvas,d(a.innerHTML),{ignoreMouse:!0,offsetX:b,offsetY:c}),n.dispatchEvent(new dm.Event("update"))},this.addElement=function(a,b,c,d,k,l){var m=window.getComputedStyle(a,null);b=b||0,c=c||0,k=void 0===k?1:k,l=void 0===l?this.autoSize:l;var o=m.getPropertyValue("text-align"),q=m.getPropertyValue("white-space"),r=m.getPropertyValue("font-family"),s=m.getPropertyValue("font-size"),t=m.getPropertyValue("font-style"),u=m.getPropertyValue("line-height"),v=m.getPropertyValue("letter-spacing"),w=m.getPropertyValue("border-top-width"),x=m.getPropertyValue("border-left-width"),y=m.getPropertyValue("border-right-width"),z=m.getPropertyValue("padding-top"),A=m.getPropertyValue("padding-left"),B=m.getPropertyValue("padding-right"),C=m.getPropertyValue("background-image"),D=f(a,m),E=g(a,m);p&&(a.parentElement&&a.parentElement.appendChild(this.canvas),this.canvas.style.letterSpacing=v),s=Number(s.replace("px","")),u="normal"===u?e(a):Number(u.replace("px","")),v=p||"normal"===v?0:Number(v.replace("px","")),z=Number(z.replace("px","")),A=Number(A.replace("px","")),B=Number(B.replace("px","")),w=Number(w.replace("px","")),x=Number(x.replace("px","")),y=Number(y.replace("px","")),l&&this.setSize(D,E),b+="center"===o?D/2:"right"===o?D-B-y:A+x,c+=z+w;var F="";if("INPUT"!=a.nodeName&&"nowrap"!==q){var G=a.cloneNode();G.style.whiteSpace="nowrap",a.parentElement.appendChild(G);var H=a.scrollWidth;G.textContent="",G.value&&(G.value="");var I,J,K,L,M=a.textContent||a.value,N=M?M.split("\n"):[];for(I=0;I<N.length;I++){for(G.textContent="",K=N[I].split(" "),J=0;J<K.length;J++)L=K[J],line=G.textContent,G.textContent+=L,J!=K.length-1&&(G.textContent+=" "),G.scrollWidth>H&&(F+=line+"\n",G.textContent=L+" ");K.length&&(F+=G.textContent),I!=N.length-1&&(F+="\n")}a.parentElement.removeChild(G)}else F=a.textContent||a.value;if(i(m,D,E,k),h(m,D,E,d,k),d=d||m.getPropertyValue("color"),this.context.globalAlpha=k,"none"!=C){var O,P;O=-1!=C.indexOf('url("')?C.substring(0,C.length-2).replace('url("',""):C.substring(0,C.length-1).replace("url(","");var P=new Image;P.onload=function(){j(P,m,D,E,k),n.dispatchEvent(new dm.Event("load")),n.addText(F,o,r,s,t,d,u,v,b,c)},P.src=O}else this.addText(F,o,r,s,t,d,u,v,b,c);p&&(a.parentElement&&a.parentElement.removeChild(this.canvas),this.canvas.style.letterSpacing=null),this.context.globalAlpha=1},this.addText=function(a,b,c,d,e,f,g,h,i,j){c=c||"'serif'",b=b||"left",d=d||16,e=e||"normal",f=f||"#000000",g=g||d,this.context.save(),this.context.font=e+" "+d+"px "+c,this.context.fillStyle=f,this.context.translate(i||0,j||0),this.context.translate(0,(d+g)/2),this.context.textAlign=b,this.context.lineWidth=1,this.context.strokeStyle=f;var k,l=a.split("\n");for(k=0;k<l.length;k++)this.addTextLine(l[k],0,k*g,h,!1,!1);this.context.restore(),n.dispatchEvent(new dm.Event("update"))},this.addTextLine=function(a,b,c,d,e,f){if("normal"===d||0===d)return void this.context.strokeText(a,b,c);if(a&&"string"==typeof a&&0!==a.length){d||(d=0),e=e!==!1,f=f!==!1;var g,h=a.split(""),i=0,j=b,k=1;if(e&&this.context.save(),"right"===this.context.textAlign)h=h.reverse(),k=-1;else if("center"===this.context.textAlign){for(var l=0,m=0;m<h.length;m++)l+=this.context.measureText(h[m]).width,m!=h.length-1&&(l+=d);j=b-l/2}for(;i<a.length;)g=h[i++],this.context.strokeText(g,j,c),j+=k*(this.context.measureText(g).width+d);e&&this.context.restore(),f&&n.dispatchEvent(new dm.Event("update"))}},this.setSize=function(a,b){if(a!=this.canvas.width||b!=this.canvas.height){this.canvas.width=a,this.canvas.height=b;var c=1;this.useDevicePixelRatio&&window.devicePixelRatio&&(c=1/window.devicePixelRatio),this.dispatchEvent(new dm.Event("resize",{width:a*c,height:b*c}))}},this.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},dm.HTMLCanvasElement.prototype=Object.create(dm.HTMLElement.prototype);